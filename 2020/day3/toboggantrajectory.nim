# day 3 - toboggan trajectory

import sequtils

proc solvePartOne(inputs: seq[string]): int =
  var
    pos: int
    depth: int

  while depth != inputs.len - 1:
    depth.inc

    if pos + 3 >= inputs[depth].len:
      pos = 3 - (inputs[depth].len - pos)
    else:
      pos += 3

    if inputs[depth][pos] == '#':
      result.inc

proc solvePartTwo(slops: seq[tuple[right, down: int]], inputs: seq[string]): int =
  var slopTrees: seq[int]

  for slop in slops:
    var
      trees: int
      depth: int
      pos: int

    while depth != inputs.len - 1:
      depth += slop.down

      if pos + slop.right >= inputs[depth].len:
        pos = slop.right - (inputs[depth].len - pos)
      else:
        pos += slop.right

      if inputs[depth][pos] == '#':
        trees.inc

    slopTrees.add trees

  result = slopTrees.foldl(a * b)

var input = @["O...#...##......##..#..#.#...#.","..######...#......#....#..#.##.","..#.#...##......#.#..#..#....#.","..#.....#..#.#........#.#..#..#","#......##..###...#.#..#.....#..","#.......##...###...#....#......",".....##...#......##.#.#..#.##..",".........#......#.....#......#.","..#.#..#....#....#......##.#.##",".#...#..#.............#.#..#.#.","....#..#.#.##.#....#..#..#....#","...#..#.....#.......#...#..#..#",".....#.....#.......#..#...#....",".##.......#...#..#........#...#","...#.......#.#.#...#.#.#......#","#....#..#.....#......##....#..#","###.#......#.#.#.#..#....#....#","......##......#.#...#...#..#...",".....#......#.#.#......#.#.....","...##...#..#........#..#.##....","..##.#.#..#...###..........#.#.",".#..#..#.....#.........#.###.#.","....##.....#...#...##..#.##...#","....#.##....#.....##......#....","........#.#.........#.#.......#","#....##.#....#..#...#..........","#..###......#....##..........##","....##.#.....#..#.##......#....","#..#......#......#.............","...##.....##.......#.......#...","#...#.#.....#..........#...###.","#.....#..#.#.###...#......###..","...##.#......#........#..#.....","......#.....###.#...##........#",".#......##......##....#....#...","..#.#..#.....##....#....#..#...","..#.#.....#.##.#.....#.....#...","....#.......#...#.........##...",".#....#..#.......##.......#....","..#..##.....#...##.##.#.#......",".##.#....#............#.......#",".......#...#..#.#.##.....##..##","..###....#..#.##........##.#...","....#.#..#.....#..#.#.....#....","..#..#.#..............#..#.....",".......#.#.#.........#......#..","...##..#.#...#......##.#.......","#....#.#.........#...#....#..##",".#..#.#...#.......#.#.#....#.##",".#..###.#..#.#.....#..#........","#.#..##.###.....##.........#..#","#...##...#..##..#..#..........#",".#...#..#......................","...##..###...........#.#...##..","..........#.#....#.#...........","..#....#....#..#....#.#.#......",".#..#.....###......#...#...#...","#.##..#..#.........#..#....#...","........#......#...#.........#.","..#.....#.#..##...#.#.#...##...","..#...........#.##..#.#..#.##..","..............##...#.#......#..","#.#..#....#...##.###........#..",".#...#..#........#........##..#",".....##..#...#.....#.#.........",".#...#...#....###...#.#.#..##..","....#.........#....###..##....#",".#....#...####...##....####.#..","..#..#.......#..#......#.#.#...","....#....#.......##..#.#.......","..#....#...........##.#.##.....","#..#..#...##.##....#.#.#.###.##","...#...#....#.#...##...#....###","......##........#.........#.#..","....#####..#..##.......#.#....#","....##..#...###....#..#.....#..","..#........#..#.#.....#....#...","..#....#......#..#...#......#..","...#.....##...#.#..##.....#..#.","...#..#.......####.##...#......",".....#..#..#.##..##....#..#.#..","..#..#..##.#.#.##..#..#...#....","...#..........#.........#....##",".##.....###...............#.##.","...##...........#.#.#......#..#",".#...#.#.##....#....#..#.......",".#...###.#....#..#..#..#......#","#..#........###...........#..#.","..#...#......#.#.#......####.#.","...#.#....##.#.....#.....##....","...###..#.#.#...#.....#.###..#.",".#.#..#...##......#..........#.","##.....#.......#.#..###...#.#..","##.###....#.....#.....###.#....","#...#..##....#.#...#...#......#",".....##.#........#.###.........",".#..#..#.#......##.#...#.#.....","#..#.#........##...........##.#","#...###..#..####..#.#..........","..#...#....#...##.#....#....##.","......#.#........#.....#..#....","#.........#...#.....#...#..##..","#....#.........#...#.##..###.#.","#...###...#.##.#.#.............","#.#....#....#......#....#.#...#","##...#.##......#..#.#....#.....","....#...#.##....#..............",".........##..........#..##..#..","......##....#.#......#.........","..#.#..............#......#..##","...........##.......#.#.#......","##...#........##.......#.#.....","....#...#...#....#.#......##...","...#..#.#.#.........#..#.#....#",".##.#...#.#.........#.....##.#.","#.#.....#.#.....#..............","..#.#..#....#..........#..##...","...#..#....................#..#","...........#...........#...#..#","............#...#............##","..#....##......##...........#..","..#..#..#....#....##......##.##","##..........#..##.##.#...#.....","............#..#........###.#..","###...##.#.#....#....#.#....#..","...#......##...#.......####....",".......#..#..#.#.....#.........","........##.......##.....#......","#.#...#.###....#..#...##.......","...#.#....#..#####.#..##.#.....","..#.#..##.......###...#.....#..","..#.......#..#...#...#..#.##...","......#..#.......#.....#....#..",".......#........#.#.......##..#",".#.#.....#.......#.......##..#.","..#.#....#.#.#####.....#...#...","#..#............###.......#..#.","........##.........#..#...###..",".#............##...#.....#.....",".#..##..#....#....#.......#....","....##..........##.............",".##..........#..#..#....#...#..","...#..#..#............####.....",".............#..#.##..#.#.##...",".....#........#....#.#.......#.","###.#..#.#...#....##...........","....#......#...#....##.......#.",".......#.#...#.#...#........##.","..........#........#..#.##.....","##..#.#.....##.#...............",".....#....#................#...","...##....#........##.#....#....",".....##...###....#.#..#.......#",".....#.#.........##....###.....",".#.....##......#..##..##...##.#",".#..............#.....#.#......",".##......#..#..#......##.......",".......#..................#....","...#.#...##......####.........#","#....#####.#.#..#..#..#...#...#","##.#...#.......#....#...#...###","...#........#.....#...#.##.....","..##....#.......#....#.......##","#......#..##...#..##.#.....#.#.","..###........#.#..#........#.#.","...#.###..........#.....#.#.#..","#.###.....#...#...#..##..###...","#....#.#.....#.#........#......","........#.......##.......#.....","...........#...#......##.......","............#...#....#..#.....#","#.#.#.#....#.....#.#..........#","#.##...#...#..#....##.#.......#","...#..#......#..#...##..##..#..","#....#......#.#.....##.#..#....","#....#..##.#......#.#.....#..##",".#..##....##....#.#...#...#....","#.#.###....#.#............#...#",".#.#....#..#..........#....#.#.","......#..#.#...............##..","..#......###.#..........#.###..","....#.##.#..#...##..#.#...#....","..............#...##.......#.##",".#...........#....#....#.##....","#..#....#.....#...#.....##...#.",".........#...#.##.......#...#.#",".....#......#.........#.#..#...","##..........#.#..##...#.#.#....","##..##.#..#..#.....#.##....#...","........##....#.#.#....#......#",".#.##...#.###....#.........#..#","..........#....###..#.........#","#.#..#.#...#.......#..##.......","..#....#...###..............##.","#..###.....####...#..#..#...#..","......#..#...###........###....","..#.....#...#.......#....###..#",".#.........#.#.#....#.#.......#","#.#.###.#.#...........#........","......#..#.........#........#..","...........##.#........#.#...#.",".....#.#......##.......#.....##","...##...#............#..#.....#",".....#..##....##...##.#..#.#...","...#...#........#.#......##....","........#..##..#..#......##.#..",".#.#.....#.....#...........#.##",".#...#.#............#......#...",".....#...#........#....#..#.#..","...##....#..#...#..............","#....##.#.#............#.......","#..#..#.....##..#........##.#.#","##..#.#....#....##.......###..#",".#.#.#.....###.....#.#......###",".....#..#...###...#....#.#...#.",".##.....................##....#",".#.....#.........#....#.....##.","#...#....#.#...###.......#.#..#","...#.................#.#....#.#",".##...#.#......................",".##.#........#...##............",".#....#.....#.........#.##..##.","#......#...##..#.........##.##.","......#......#...####..#.##....",".###....#..##......#.##......#.","..#...#....#..#.......#.#......","#....#...#.................#.#.","....#.#.#..#...#..#.......#.#.#","#.#...##.......#.....##.#......","#.........#.....##..##..#......","....#..##..#.....#..#..#.#..#..","......#.#..#.#.#....#.#.......#",".##......#..#....##...##..#....","..#..#......#...##..#.##.....#.","..#..#.......#.#....#.....#...#","....#.#.....###...#.......#.#..","..#....##.....##.#........##...","#...............##....#.....##.",".#.........#....#...##.###.##.#",".#.##..#.............#.#.#..#..",".#.....#.................##....","..####.........#.#......#.#..#.","#.......#..........#.#........#",".#.#...##.....#.#.......#....#.","..#.##.#.......###....#....#...",".#....##.............##.#.#.#..","#.#.....#.#.#.#..#......##..#..",".............#..........#.#.#..","...#.#.............#.#...##....",".......#..#.#.......#..#.#....#",".............#.........###..#..",".#.#..#....#.....#..#.....#...#","#.....#....##..##.#..#........#","..##..###.....##....#.#..#.....","..#...##....#...#.#..........#.","...##..##.#.....#....#.........","..#...#........##.#..#........#","#.............#.###......#.##..",".#...#........#...........#...#","..##.......#.#..##.##......#...","...#.#...##....##..#...........",".#......##........#....##....#.",".........#..#....#...#..##.##..","....#..#.#...#.......#.#.##....","...#.#......#.#..#..#.#....#..#",".......#........#.........###..","#.#..#.#.........##............","##..##..#.##..###...#.#...#....",".#....#.#..#...#....#.##.....#.",".#.#.#.#........##...#..#.#.##.",".#..#.#..#...........#..#......","..#.##.#...#....#.........#...#",".....##...#.#...#...#....#.....","..#..........#.#.#.......##.#..","#.#............#..#.....#..#...","..#...........##.#.##.#....#..#","#..####.....#............#.....",".##......#####.#..#.....#....#.","...##..#.#......#.#..#..#...##.","#....................#.##...#.#","...#............#.............#","....#.##..........#.....#......","....##..##....#.#..............","...........#....##.#.....#.....","....#.....#....#....#......#...","#...##........#...#........#.#.","........#.....##..#.##.#..#.#.#","....##......##....#.....##....#","...#.#........##.......#...##..","#......##..#.#.#....##......#..","..#.......#.......##..#.##.....",".#...#...#.#.............##....","......#.#.#.........##...#..#.#",".....#..####....#.##..........#","...#...#.#....#.....#..#.....##",".........#.......#......###....","........##..##..#.#.#...###...#",".#..##.#....#...##.....#.#.#...","........##...#...##..#.........",".........#.......#.##..#...####","#......#.....#..............#.#","##..##.#.##.....##...........#.","#.............#.........#......","...####.#.##..#.#.#.##.#......#","..#.....##....#...#............","#..............#......#...###..","..#..#.#...#.##.........##.....","..#...##..#........#..#.##..##.","......###...#..#....#..#.###...","...##.##.###.....##.#.......#..","#....#..###..#.......#.#.#..#..","..##.............##..##...###.#",".#.#..#.........#..........#...",".........#.#.....##...#..#...##","....#..#....#####..#...#..#....","...#.....#.....#...#.#..#.#....",".#..#.............#.......##.#.","...##.......#.#.....##......#..","...........##..#.##..###...#.#.","...........#...........#...#..#","..#....#.##.#..#..#...........#","..#.....##...#......#...#......","...###.###.....##..........#..#"]
var slops = @[(1,1),(3,1),(5,1),(7,1),(1,2)]

echo solvePartOne(input)
echo solvePartTwo(slops, input)
